# План полного переноса Viewer в Godot (MVP = полный паритет Viewer)

Ниже — **первый шаг**: список функций, которые обязаны быть в первой версии Godot, и минимальный план работ. Текст короткий и “по‑простому”, без лишних деталей.

## 1) Что должно быть 1:1 как в текущем viewer
Все пункты ниже — **обязательны** для первой версии (полный паритет).

### 1.1 Карта и визуализация
- Сетка поля с размерами `board.width` × `board.height`.
- Юниты как кружки, разные цвета для сторон **Игрок/Модель**.
- Отрисовка **нескольких юнитов в одной клетке** со смещением.
- Подписи ID возле юнитов.
- Цели (objectives) с ID, цветом владельца (Игрок/Модель/Нейтрал).
- Радиус контроля целей (пунктирный круг) + переключатель видимости.
- Hover‑подсказка по юниту (ID, имя, HP, модели, координаты).
- Выделение выбранного юнита.
- Подсветка доступного перемещения активного юнита.
- Подсветка доступных целей стрельбы активного юнита.

### 1.2 Статусы и очки
- Отображение: Раунд, Ход, Фаза, Активная сторона.
- Очки VP/CP для Игрока и Модели.

### 1.3 Таблица юнитов
- Колонки: Сторона, ID, Имя, HP, Модели.
- Сортировка по колонкам.
- Клик по строке — выделяет юнита на карте.
- Клик по юниту — выделяет строку в таблице.

### 1.4 Командная панель
Варианты запросов и их UI:
- Text (строка ввода + кнопка).
- Direction (кнопки ↑ ↓ ← → и “Нет”).
- Bool (Да/Нет).
- Int (спинбокс + ОК).
- Choice (комбо + ОК).
- Dice (обычный ввод, но с подсказкой формата).

Горячие клавиши:
- Direction: стрелки, пробел/0.
- Bool: Y/N.
- Int/Choice: Enter.

### 1.5 Логи (LOGS_FOR_AGENTS.md)
- Таб‑панель: Все / Ход / Стрельба / Ближний бой / Кубы / Ошибки.
- Фильтр “Показать только текущий ход”.
- Кнопка “Копировать ход”.
- Кнопка “Очистить”.
- Автодобавление строк из `log_tail`.
- Классификация строк по категориям (turn/shooting/fight/dice/errors).
- Ротация файла лога при большом размере.

## 2) Откуда берутся данные (как сейчас)
В viewer все берётся из `state.json` (или другого пути состояния):
- `board`, `turn`, `round`, `phase`, `active`, `vp`, `cp`, `units`, `objectives`, `log_tail`.
В Godot нужно повторить этот формат 1:1, чтобы ничего не ломать.

## 3) План работ (минимальный и безопасный)

### Шаг 1 — Каркас проекта Godot
- Пустой проект + главная сцена.
- Базовый UI‑каркас: левый блок карта, правый блок статус/очки/юниты/команды, низ — логи.

**Сделано:**
- Шаг 1 выполнен: базовый UI‑каркас собран, основная сцена готова.

### Шаг 2 — Импорт состояния
- Скрипт чтения `state.json` + автообновление при изменении файла.
- Валидация ключей и безопасные дефолты.

**Сделано:**
- Шаг 2 выполнен: читаем `state.json` и обновляем состояние по таймеру.

### Шаг 3 — Карта + юниты + цели
- Отрисовка сетки, кружков юнитов, целей, ID.
- Hover‑подсказки, выбор, подсветки.
- Переключатель радиуса целей.

**Сделано частично:**
- Сетка, юниты, ID и цели с радиусом — есть.
- Переключатель радиуса целей — есть.
- Hover/выбор/подсветки — ещё нет.

### Шаг 4 — Панели статуса и таблица юнитов
- Таблица + сортировка + синхронизация выбора.

**Сделано частично:**
- Статусы и очки обновляются.
- Таблица юнитов есть, но без сортировки и синхронизации выбора.

### Шаг 5 — Командная панель
- Реализация 5 типов UI + горячие клавиши.
- Подсказки по вводу (в т.ч. кубы).

**Сделано частично:**
- Текстовый ввод + кнопка есть, команда пишется в файл (через `COMMAND_PATH`).
- Остальные типы UI и горячие клавиши — ещё нет.

### Шаг 6 — Логи
- Таб‑фильтры, тексты, “только ход”.
- Копировать ход, очистка.
- Запись в LOGS_FOR_AGENTS.md, ротация.

## 4) Что делать дальше (простыми словами)
**Следующий план, чтобы дойти до паритета Viewer:**
1. Карта: hover‑подсказки, выбор юнита, подсветки перемещения/целей.
2. Таблица юнитов: сортировка, клик по строке ↔ выделение на карте.
3. Команды: direction/bool/int/choice/dice и хоткеи как в Viewer.
4. Логи: разбор по вкладкам, фильтры и кнопки (копировать/очистить).

Если готов — напиши, **в каком формате ты хочешь Godot (GDScript или C#)** и где лежит актуальный `state.json`.
